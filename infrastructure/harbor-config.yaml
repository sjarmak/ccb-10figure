# Harbor Configuration for CodeContextBench
#
# This file defines container runtime, agent, and task execution settings.
# Used by runners and infrastructure setup scripts.

# Container runtime configuration
runtime:
  # Container runtime: "podman" (default, recommended) or "docker"
  # If using podman, ensure docker wrapper is in PATH: export PATH="$HOME/bin:$PATH"
  container_runtime: podman
  
  # Task execution timeout (seconds)
  timeout_sec: 3600  # 1 hour
  
  # Container networking
  network: bridge

# Agent installation and execution defaults
agent_defaults:
  # Agent installation timeout (seconds)
  install_timeout_sec: 300
  
  # Maximum memory per container (GB)
  memory_limit_gb: 4
  
  # CPU cores per container
  cpu_cores: 2
  
  # Environment variables to pass to agent containers
  # These are merged with values from .env.local
  environment:
    PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    HOME: /root
    LANG: en_US.UTF-8

# Task execution configuration
task_execution:
  # Number of parallel workers for Harbor
  parallel_workers: 4
  
  # Result format: "json" (recommended)
  result_format: json
  
  # Enable log capture from containers
  log_capture: true
  
  # Log collection paths (relative to task directory)
  log_paths:
    - logs/agent.txt
    - logs/stdout.log
    - logs/stderr.log
    - logs/result.json
  
  # Artifact collection (files to extract from container after execution)
  artifacts:
    - patch.diff
    - run_manifest.json
    - logs/

# Benchmark environment configurations
# Each environment maps to a dataset and defines task counts/characteristics
environments:
  terminal-bench-2.0:
    # Dataset ID (as referenced by harbor run -d)
    dataset: terminal-bench@2.0
    
    # Total tasks in this benchmark
    task_count: 89
    
    # Task types in this benchmark
    task_types:
      - implementation
      - debugging
      - refactoring
  
  10figure-codebases:
    dataset: 10figure  # Requires HARBOR_10FIGURE env var
    
    # Estimated task count (varies by corpus version)
    task_count: 100
    
    # Task types for cross-file reasoning
    task_types:
      - cross_file_reasoning
      - refactor_rename
      - api_upgrade
      - bug_localization
    
    # Dataset-specific configuration
    dataset_config:
      # Base path in container where corpus is mounted
      corpus_path: /10figure
      
      # Environment variable that specifies corpus path
      corpus_env_var: HARBOR_10FIGURE
      
      # Minimum disk space required (MB)
      min_disk_space_mb: 5120

# Agent-specific configurations
agents:
  claude-baseline:
    # Agent class path for Harbor
    class: agents:ClaudeAgent
    
    # Installation template
    install_template: agents/install-claude.sh.j2
    
    # Model to use
    model: claude-3-5-sonnet
    
    # Which Sourcegraph features are enabled
    tools:
      - file_operations  # cat, ls, find, grep
      - git_operations   # git diff, git log
      # Note: claude-baseline does NOT include code_search
  
  claude-mcp:
    # Agent class path for Harbor
    class: agents:ClaudeAgent
    
    # Installation template
    install_template: agents/install-claude-mcp.sh.j2
    
    # Model to use
    model: claude-3-5-sonnet
    
    # Which Sourcegraph features are enabled
    tools:
      - file_operations   # cat, ls, find, grep
      - git_operations    # git diff, git log
      - code_search       # MCP-based Sourcegraph Deep Search
    
    # MCP configuration
    mcp_config: infrastructure/mcp-config.json

# Result validation and aggregation
results:
  # Schema version for result.json validation
  schema_version: "1.0"
  
  # Required fields in result.json
  required_fields:
    - task_id
    - task_name
    - success
    - reward
    - duration_sec
    - agent_execution
    - verifier_result
  
  # Timeout for result file appearance
  result_timeout_sec: 60

# Observability and monitoring
observability:
  # Enable NeMo-Agent-Toolkit tracing (if agent supports it)
  nemo_tracing: true
  
  # Enable metrics collection
  metrics_enabled: true
  
  # Manifest output format
  manifest_format: json
  
  # Metrics to collect
  metrics:
    - execution_time
    - tool_usage
    - token_counts
    - failure_rates
    - cost_usd

# Advanced options
advanced:
  # Enable debug logging in containers
  debug: false
  
  # Keep containers running after failure (for debugging)
  keep_failed_containers: false
  
  # Enable container resource monitoring
  resource_monitoring: true
  
  # Container log level (error, warn, info, debug)
  log_level: info
